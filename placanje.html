<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Novo ropstvo — Uplata i preuzimanje</title>
  <link rel="icon" href="images/favicon.png">
  <style>

    :root{{
      --brand:#0a62c9; /* kao na live sajtu */
      --text:#121212;
      --muted:#555;
      --border:#e6e6e6;
      --bg:#ffffff;
    }}


*{{box-sizing:border-box}}
body{{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;margin:0;line-height:1.6;color:var(--text);background:var(--bg)}}
header,main,footer{{max-width:980px;margin:0 auto;padding:16px}}
header{{display:flex;gap:12px;align-items:center;justify-content:space-between}}
nav a{{margin-right:12px;text-decoration:none;color:var(--brand)}}
nav a[aria-current="page"]{{text-decoration:underline}}
footer{{border-top:1px solid var(--border);color:var(--muted)}}

[hidden]{{display:none !important}}
.langswitch{{display:flex;gap:8px;margin:6px 0 16px}}
.langswitch button{{padding:6px 10px;border-radius:10px;border:1px solid #ccc;background:#f8f8f8;cursor:pointer}}
.langswitch button:disabled{{background:var(--brand);border-color:var(--brand);color:#fff;cursor:default}}
form label{{display:block;margin:10px 0 4px}}
input,button{{font:inherit}}
input{{padding:10px;border-radius:10px;border:1px solid #ccc;min-width:260px}}
button{{padding:10px 16px;border-radius:12px;border:1px solid var(--brand);background:var(--brand);color:#fff;cursor:pointer}}
.hint{{color:var(--muted);font-size:14px}}

</style>
</head>
<body>
  <header>
    <a href="index.html" aria-label="Početna"><strong>NOVO ROPSTVO</strong></a>
    <nav aria-label="Glavna navigacija">
      <a href="index.html">Početna</a>
      <a href="galerija.html">Galerija</a>
      <a href="odlomak.html">Odlomak</a>
      <a href="placanje.html#sr" aria-current="page">Uplata</a>
    </nav>
  </header>

  <main>
    <nav class="langswitch" aria-label="Language switch">
      <button type="button" data-switch-lang="sr">SR</button>
      <button type="button" data-switch-lang="en">EN</button>
      <button type="button" data-switch-lang="cz">CZ</button>
    </nav>

    <section data-lang="sr">
      <h1>Uplata i preuzimanje EPUB izdanja</h1>
      <form id="dl-sr">
        <label for="kod-sr">Unesite kod</label>
        <input id="kod-sr" name="kod" required autocomplete="one-time-code" inputmode="latin">
        <label for="email-sr">Email (opciono)</label>
        <input id="email-sr" name="email" type="email" placeholder="vas@email.com">
        <button type="submit">Preuzmi EPUB</button>
      </form>
      <p class="hint">Ako dobijete grešku 404, proverite da li je kod važeći i da li je link ka EPUB fajlu dostupan.</p>

      <h3>Kako platiti (399 RSD)</h3>
      <ul>
        <li><strong>Bankovni transfer</strong><br>Primalac: Marjan Mitrović • IBAN: CZxx xxxx xxxx • Svrha: NOVO ROPSTVO</li>
        <li><strong>Paysend</strong> (dinari → CZK) — uplata na isti IBAN; konverzija je automatska.</li>
      </ul>
    </section>

    <section data-lang="en" hidden>
      <h1>Payment & Download the EPUB Edition</h1>
      <form id="dl-en">
        <label for="code-en">Enter your code</label>
        <input id="code-en" name="code" required autocomplete="one-time-code">
        <label for="email-en">Email (optional)</label>
        <input id="email-en" name="email" type="email" placeholder="you@example.com">
        <button type="submit">Download EPUB</button>
      </form>
      <p class="hint">If you get a 404, ensure your code is valid and the EPUB link is accessible.</p>
    </section>

    <section data-lang="cz" hidden>
      <h1>Platba a stažení EPUB vydání</h1>
      <form id="dl-cz">
        <label for="kod-cz">Zadejte kód</label>
        <input id="kod-cz" name="kod" required autocomplete="one-time-code">
        <label for="email-cz">E-mail (volitelné)</label>
        <input id="email-cz" name="email" type="email" placeholder="vy@example.com">
        <button type="submit">Stáhnout EPUB</button>
      </form>
      <h3>Jak zaplatit (399 RSD)</h3>
      <ul>
        <li><strong>Bankovní převod</strong><br>Příjemce: Marjan Mitrović • IBAN: CZxx xxxx xxxx • <strong>Účel: NOVÉ OTROCTVÍ</strong></li>
        <li><strong>Paysend</strong> (RSD → CZK) — převod na stejný IBAN; konverze je automatická.</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Marjan Mitrović. Sva prava zadržana.</p>
  </footer>

  <script src="config.js"></script>
  <script>
  (function(){
    const LSKEY = "nr_lang";
    const sections = Array.from(document.querySelectorAll('[data-lang]'));
    const buttons  = Array.from(document.querySelectorAll('[data-switch-lang]'));
    function show(lang){
      sections.forEach(s=>s.hidden = s.dataset.lang !== lang);
      buttons.forEach(b=>b.disabled = b.dataset.switchLang === lang);
      try{ localStorage.setItem(LSKEY, lang); }catch(e){}
      if(location.hash !== '#'+lang) history.replaceState(null, '', '#'+lang);
    }
    const initial = (location.hash||'').replace('#','') || (localStorage.getItem(LSKEY)||'sr');
    show(/^(sr|en|cz)$/.test(initial) ? initial : 'sr');
    buttons.forEach(b=>b.addEventListener('click', ()=>show(b.dataset.switchLang)));
  })();
  </script>

  <script>
  async function verifyForm(formId){
    const form = document.getElementById(formId);
    if(!form) return;
    form.addEventListener("submit", async (ev)=>{
      ev.preventDefault();
      const data = new FormData(form);
      const kod   = data.get("kod") || data.get("code");
      const email = data.get("email") || "";
      try {
        const res  = await fetch(window.NR_WEB_APP_URL + "?kod=" + encodeURIComponent(kod) + "&email=" + encodeURIComponent(email));
        const html = await res.text();
        document.body.innerHTML = html;
      } catch(err) {
        alert("❌ Greška u konekciji: " + err.message);
      }
    });
  }
  ["dl-sr","dl-en","dl-cz"].forEach(verifyForm);
  </script>
</body>
</html>
